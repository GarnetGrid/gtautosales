var DealerCenter,__awaiter=this&&this.__awaiter||function(e,o,r,t){return new(r||(r=Promise))(function(n,i){function s(e){try{c(t.next(e))}catch(e){i(e)}}function a(e){try{c(t.throw(e))}catch(e){i(e)}}function c(e){var o;e.done?n(e.value):(o=e.value,o instanceof r?o:new r(function(e){e(o)})).then(s,a)}c((t=t.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(e,o){var r,t,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,t&&(n=2&a[0]?t.return:a[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,a[1])).done)return n;switch(t=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,t=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=o.call(e,i)}catch(e){a=[6,e],t=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(e){!function(o){!function(o){var r=function(){function o(e){jQuery;this.form=e,this.formThankYouMessage=jQuery("#"+e.attr("id")+"-thank-you-message"),this.formErrorMessageWrapper=e.find(".dws-forms-error-wrapper"),this.formValidationErrorMessageWrapper=e.find(".dws-forms-validation-error-wrapper"),console.log("DWSFormsScript constructor: "+this.form.attr("id")),this.initForm()}return o.prototype.initForm=function(){var r=this,t=jQuery,n=this.form;if(n.data("form-data")||n.data("form-data",{}),n.data("form-data").session&&n.data("form-data").session.applicantCid||(n.data("form-data").session.applicantCid=o.getCookie("cid")),n.data("form-data").session&&n.data("form-data").session.applicantSid||(n.data("form-data").session.applicantSid=o.getCookie("sid")),!n.data("form-data").session||!n.data("form-data").session.sourceMedian){var i=decodeURIComponent(o.getCookie("dws-ts-js")),s=null,a=null,c=null,l=null,d=null;if(i&&""!==i)i.split("|").forEach(function(e){var o=e.split("=");if(2===o.length){var r=o[0],t=o[1];switch("(direct)"===t?t="direct":"(none)"!==t&&"(not set)"!==t||(t=null),r){case"utmcsr":s=t;break;case"utmcmd":a=t;break;case"utmccn":c=t;break;case"utmcct":l=t;break;case"utmctr":d=t}}});var m=7;if(a){var f=a.toLowerCase();m="organic"===f?1:"referral"===f?3:"cpc"===f||"ppc"===f||"paid-search"===f||"adwords"===f||"google-ads"===f?4:"social"===f?5:"social-paid"===f||"paid-social"===f||"facebook-ads"===f||"linkedin-ads"===f||"twitter-ads"===f?6:7}else if(s){var u=s.toLowerCase();m="direct"===u?2:"google"===u||"bing"===u||"yahoo"===u||"duckduckgo"===u?1:3}else m=2;n.data("form-data").session||(n.data("form-data").session={}),n.data("form-data").session.sourceMedian=i,n.data("form-data").session.utmSource=s,n.data("form-data").session.utmMedium=a,n.data("form-data").session.utmCampaign=c,n.data("form-data").session.utmContent=l,n.data("form-data").session.utmTerm=d,n.data("form-data").session.trafficSourceID=m}console.log(n.data("form-data"));var p=n.find(".dws-forms-section-file-attachments").length>0;if(p){var g=new e.WebSite.Plugins.DWSFormsScriptMulipleFileAttachments(n);g.init()}var h=document.querySelector("#dws-forms-cover-letter-file-input");h&&h.addEventListener("change",function(e){var o=e.target,r=o.files&&o.files[0];if(r){var t=r.type;["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t)?(h&&h.nextElementSibling&&(h.nextElementSibling.textContent=""),o.setCustomValidity("")):(h&&h.nextElementSibling&&(h.nextElementSibling.textContent="File Type Not Supported. Supported file types are .docx, .pdf"),o.setCustomValidity("File Type Not Supported. Supported file types are .docx, .pdf"))}else h&&h.nextElementSibling&&(h.nextElementSibling.textContent=""),o.setCustomValidity("");o.reportValidity()}),n.find(".dws-forms-button-submit").on("click",function(i){return __awaiter(r,void 0,void 0,function(){var r,s,a,c,l,d,m,f,u;return __generator(this,function(h){switch(h.label){case 0:i.preventDefault(),console.log("submit button clicked"),this.formErrorMessageWrapper.hide(),this.formErrorMessageWrapper.removeAttr("role"),this.formValidationErrorMessageWrapper.hide(),this.formValidationErrorMessageWrapper.removeAttr("role"),r=n.find(".dws-forms-button-submit"),h.label=1;case 1:return h.trys.push([1,10,11,12]),this.setLoadingBtn(r),[4,this.markInvalidFormFields()];case 2:return h.sent()>0?(console.log("invalid field input found."),this.showSubmissionValidationErrorMessage(),n.find(".dws-forms-form-control:invalid, .dws-forms-form-file-control:invalid, .dws-forms-form-select:invalid, .dws-forms-form-radio:invalid, .dws-forms-form-checkbox:invalid, .dws-forms-form-textarea:invalid").first().focus(),[2]):[3,3];case 3:return[4,this.mapFormFields()];case 4:return h.sent(),[4,this.setReCaptchaToken()];case 5:return h.sent(),[4,this.getCsrfToken()];case 6:return s=h.sent(),n.data("form-data").isThirdParty||this.setRefererAndTrafficSource(),[4,this.uploadFiles(p,g,s)];case 7:return h.sent(),[4,this.submitForm(s)];case 8:if("statusCode"in(a=h.sent())&&"OK"==a.statusCode){if(this.showThankYouMessage(),c=n.data("form-data"),this.trackFormSubmissionEvent(c),c.session&&c.session.isCaraForm)try{(l=document.querySelector('iframe[src*="chatdws"]'))&&l.contentWindow?(l.contentWindow.postMessage(JSON.stringify({action:"dc-chat/actions",data:{type:"customerstage",stage:6}}),"*"),console.log("CARA form submission notification sent to chat")):console.warn("Chat iframe not found, cannot send stage update")}catch(e){console.error("Error sending CARA form notification:",e)}if(14==c.inquiryType&&null==c.secondaryInquiryType&&new e.WebSite.Plugins.DWSFormsTestimonialsFunctionality(c).store_testimonial_to_dws_admin(),"FollowVehicle"==c.secondaryInquiryType){if(d=o.getCookie("dws-followed-vehicles"),m=""==d?new Array:d.split(","),f=n.find(".dws-forms-stock-number .dws-forms-value").text(),-1!==t.inArray(f,m))return[2];m.push(f),o.setCookie("dws-followed-vehicles",m)}}h.label=9;case 9:return[3,12];case 10:return u=h.sent(),console.error(u),console.log("submit process failed."),this.showSubmissionErrorMessage(),[3,12];case 11:return this.setLoadingBtn(r,!1),[7];case 12:return[2]}})})}),this.attachAccordionToggleToCheckboxes()},o.prototype.trackFormSubmissionEvent=function(e){var r=jQuery;try{var t=o.getCookie("cid"),n=o.getCookie("sid"),i=decodeURIComponent(o.getCookie("dws-trs")),s=decodeURIComponent(o.getCookie("dws-ts-js")),a=decodeURIComponent(o.getCookie("dws_geo_ip")),c=null;if(i&&""!==i)try{c=JSON.parse(i).RF}catch(e){console.log("[Form Tracker] Error parsing traffic source:",e)}var l=window.location.origin+window.location.pathname,d=null,m=null,f=null,u=null,p=null;if(s&&""!==s)s.split("|").forEach(function(e){var o=e.split("=");if(2===o.length){var r=o[0],t=o[1];switch("(direct)"!==t&&"(none)"!==t&&"(not set)"!==t||(t=null),r){case"utmcsr":d=t;break;case"utmcmd":m=t;break;case"utmccn":f=t;break;case"utmcct":u=t;break;case"utmctr":p=t}}});var g={eventTypeID:8,inquiryTypeID:e.inquiryType||null,session:{dcCompanyId:"undefined"!=typeof DWS_DCID?DWS_DCID:null,blogId:"undefined"!=typeof DWS_BLOG_ID?DWS_BLOG_ID:null,referer:c,ipAddress:a,applicantCid:t,applicantSid:n,landingUrl:l,sourceMedian:s,utmSource:d,utmMedium:m,utmCampaign:f,utmContent:u,utmTerm:p}};"undefined"!=typeof DWS_TRACKING_SITE&&DWS_TRACKING_SITE?(r.ajax({url:DWS_TRACKING_SITE+"/collect/event",type:"POST",cache:!1,contentType:"application/json",dataType:"json",data:JSON.stringify(g),error:function(e,o,r){console.log("[Form Event Tracker] Error: textStatus="+o+"|errorThrown="+r)}}),console.log("[Form Event Tracker] Form submission tracked for inquiryType:",e.inquiryType)):console.log("[Form Event Tracker] Tracking disabled - DWS_TRACKING_SITE not available")}catch(e){console.error("[Form Event Tracker] Error tracking form submission:",e)}},o.prototype.setRefererAndTrafficSource=function(){console.log("setting referer and traffic source...");var e=this.form,r="",t=decodeURIComponent(o.getCookie("dws-trs"));""!=t&&(r=JSON.parse(t).RF);var n=decodeURIComponent(o.getCookie("dws-ts-js"));28==e.data("form-data").inquiryType&&"RequestMileage"==e.data("form-data").secondaryInquiryType||29==e.data("form-data").inquiryType&&"RequestPrice"==e.data("form-data").secondaryInquiryType||26==e.data("form-data").inquiryType&&"RequestVIN"==e.data("form-data").secondaryInquiryType?e.data("form-data").session.referrer=e.data("form-data").session.referrer:e.data("form-data").session.referrer=""!=r?r:null,e.data("form-data").session.sourceMedian=""!=n?n:null},o.prototype.uploadFiles=function(e,o,r){jQuery;var t=this.form;return console.log("checking if files need to be uploaded..."),e&&t.find("#total-file-count-pending-upload").length>0&&parseInt(t.find("#total-file-count-pending-upload").val())>0?new Promise(function(e,n){console.log("triggering file upload..."),t.find("#dws-trigger-click-upload").trigger("click",[{token:r}]),t.find("#total-file-successfully-uploaded").length>0&&parseInt(t.find("#total-file-successfully-uploaded").val())>0&&o.addFilesToPayload(),e()}):new Promise(function(e,o){e()})},o.prototype.submitForm=function(e){var o=this,r=jQuery,t=this.getAjaxOptions();return new Promise(function(n,i){r.ajax({url:t.url,method:"POST",headers:{"X-CSRF-TOKEN":e},contentType:t.contentType,processData:t.processData,data:t.data,success:function(e){"success"in e&&1==e.success?console.log("form submitted successfully: "+e.statusCode):"success"in e&&0==e.success?(o.showSubmissionErrorMessage(),console.log("form submission failed: "+e.statusCode)):(console.log("form submission failed: "+e),o.showSubmissionErrorMessage()),n(e)},error:function(e){console.log("form service error: "+e.status),i(e)}})})},o.prototype.getAjaxOptions=function(){jQuery;var o=this.form,r=o.data("form-data");console.log(r);var t=new URLSearchParams(window.location.search);(r.session&&r.session.isCaraForm||"1"===t.get("aichat"))&&(r.leadSource="AI Chat",console.log('Setting leadSource to "AI Chat" for AI Chat-initiated form'));var n={url:dwsFormsScriptSettings.actionUrl,contentType:"application/json",processData:!0,data:JSON.stringify(r)};if(12==r.inquiryType){var i=new e.WebSite.Plugins.DWSFormsCareerDataPreProcessing(o);n.url=dwsFormsScriptSettings.actionUrl+"/careers",n.contentType=!1,n.processData=!1,n.data=i.getFormData()}return n},o.prototype.mapFormFields=function(){var o=this,r=jQuery,t=this.form;return console.log("mapping form fields..."),new Promise(function(n,i){if(t.find(".dws-forms-form-control, .dws-forms-form-file-control, .dws-forms-form-select, .dws-forms-form-radio, .dws-forms-form-checkbox, .dws-forms-form-textarea").each(function(o,n){var i=r(n),s=i.data("form-json-field-map"),a=i.data("form-section");if(s&&"disabled"!=i.attr("disabled"))for(var c=i.val(),l=s.split("."),d=t.data("form-data"),m=0;m<l.length;m++)if(m==l.length-1)if(""!=c)if("number"==i.data("data-type")){var f=c;void 0!==e.WebSite.Plugins.DWS_Input_Price_Format&&"function"==typeof e.WebSite.Plugins.DWS_Input_Price_Format.sanitizedMoneyValue&&(f=e.WebSite.Plugins.DWS_Input_Price_Format.sanitizedMoneyValue(c)),r.isNumeric(f)&&(d[l[m]]=parseFloat(f))}else d[l[m]]=c;else delete d[l[m]];else d[l[m]]||(d[l[m]]={}),d=d[l[m]];switch(a){case"vehicle_information":console.log("pre processing vehicle information section..."),new e.WebSite.Plugins.DWSFormsVehicleInformationSectionDataPreProcessing(i,t).init();break;case"survey_information":console.log("pre processing survey information section..."),new e.WebSite.Plugins.DWSFormsSurveyInformationSectionDataPreProcessing(i,t).init();break;case"personal_information":console.log("pre processing personal information section..."),new e.WebSite.Plugins.DWSFormsPersonalInformationSectionDataPreProcessing(i,t).init();break;case"employment_information":console.log("pre processing employment information section..."),new e.WebSite.Plugins.DWSFormsEmploymentInformationSectionDataPreProcessing(t,i).init();break;case"co_buyer_employment_information":console.log("pre processing co buyer employment information section..."),new e.WebSite.Plugins.DWSFormsCoBuyerEmploymentInformationSectionDataPreProcessing(i,t).init();break;case"residential_information":console.log("pre processing residential information section..."),new e.WebSite.Plugins.DWSFormsResidentialInformationSectionDataPreProcessing(t,i).init();break;case"delivery_details":console.log("pre processing delivery details section..."),new e.WebSite.Plugins.DWSFormsDeliveryDetailsSectionDataPreProcessing(i,t).init();break;case"other_information":if(console.log("pre processing other information section..."),void 0===e.WebSite.Plugins.DWSFormsOtherInformationSectionDataPreProcessing)break;new e.WebSite.Plugins.DWSFormsOtherInformationSectionDataPreProcessing(i,t).init();break;case"contact_information":default:if(console.log("pre processing default/contact information section..."),void 0===e.WebSite.Plugins.DWSFormsContactInformationSectionDataPreProcessing)break;new e.WebSite.Plugins.DWSFormsContactInformationSectionDataPreProcessing(i,t).init()}}),console.log("pre processing after..."),1==t.data("form-data").inquiryType&&!o.form.data("form-data").secondaryInquiryType){console.log("pre processing credit application...");var s=new e.WebSite.Plugins.DWSFormsEmploymentInformationSectionDataPreProcessing(t),a=new e.WebSite.Plugins.DWSFormsPreviousAddressSectionDataPreProcessing(t),c=new e.WebSite.Plugins.DWSFormsPreviousEmploymentSectionDataPreProcessing(t),l=new e.WebSite.Plugins.DWSFormsAdditionalEmploymentInformationSectionDataPreProcessing(t),d=new e.WebSite.Plugins.DWSFormsTradeInSectionDataPreProcessing(t),m=new e.WebSite.Plugins.DWSFormsAdditionalInfoSectionDataPreProcessing(t),f=new e.WebSite.Plugins.DWSFormsReferencesSectionDataPreProcessing(t),u=new e.WebSite.Plugins.DWSFormsCommentAndOthersSectionDataPreProcessing(t);new e.WebSite.Plugins.DWSFormsResidentialInformationSectionDataPreProcessing(t).setFieldsToComment(),s.setFieldsToComment(),a.init(),c.init(),l.init(),d.init(),m.init(),f.init(),u.init()}o.removeEmptyObjects(t.data("form-data")),console.log("form fields mapped."),n()})},o.prototype.removeEmptyObjects=function(e){jQuery;for(var o in e){var r=e[o];"object"==typeof r&&(r&&0===Object.keys(r).length&&r.constructor===Object?delete e[o]:this.removeEmptyObjects(r))}},o.prototype.markInvalidFormFields=function(){jQuery;var e=this.form;console.log("getting list of invalid fields..."),e.find('.dws-forms-form-control:not([type="hidden"]), .dws-forms-form-file-control, .dws-forms-form-select, .dws-forms-form-radio, .dws-forms-form-checkbox, .dws-forms-form-textarea').attr("aria-invalid","false");var o=e.find(".dws-forms-form-control:invalid, .dws-forms-form-file-control:invalid, .dws-forms-form-select:invalid, .dws-forms-form-radio:invalid, .dws-forms-form-checkbox:invalid, .dws-forms-form-textarea:invalid");return o.attr("aria-invalid","true"),console.log(o),new Promise(function(r,t){var n=o.length;e.addClass("was-validated"),r(n)})},o.prototype.getCsrfToken=function(){var e=jQuery,o=this.form,r=o.data("form-data");console.log("getting csrf token...");var t=new URL(r.session.landingUrl);return new Promise(function(n,i){e.ajax({url:"/wp-admin/admin-ajax.php",method:"POST",data:{action:"get_form_token",form_id:o.attr("id"),dcCompanyId:r.dcCompanyId,hostname:"https://"+t.hostname,_wpnonce:jQuery("[name='_wpnonce']",o).val(),_wp_http_referer:jQuery("[name='_wp_http_referer']",o).val()},success:function(e){console.log("csrf token received."),n(e)},error:function(e){console.log("csrf token error: "+e),i(e)}})})},o.prototype.setReCaptchaToken=function(){var e=this,o=(jQuery,this.form);return console.log("getting recaptcha token..."),new Promise(function(r,t){grecaptcha.enterprise.ready(function(){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,grecaptcha.enterprise.execute(dwsFormsScriptSettings.greCaptchaSiteKey,{action:"submitform"})];case 1:return e=i.sent(),o.data("form-data").reCaptcha=e,console.log("recaptcha token received and set in form."),r(),[3,3];case 2:return n=i.sent(),console.log(n),t(),[3,3];case 3:return[2]}})})})})},o.prototype.showThankYouMessage=function(){var e=jQuery,o=this.form;console.log("showing thank you message..."),o.hide(),o.trigger("reset"),this.formThankYouMessage.show(),this.formThankYouMessage.attr("role","alert"),this.formThankYouMessage.attr("aria-live","assertive"),this.formErrorMessageWrapper.is("[role]")&&this.formErrorMessageWrapper.removeAttr("role"),this.formErrorMessageWrapper.is("[aria-live]")&&this.formErrorMessageWrapper.removeAttr("aria-live"),this.formValidationErrorMessageWrapper.is("[role]")&&this.formValidationErrorMessageWrapper.removeAttr("role"),this.formValidationErrorMessageWrapper.is("[aria-live]")&&this.formValidationErrorMessageWrapper.removeAttr("aria-live"),o.closest(".modal").on("hidden.bs.modal",function(r){o.trigger("reset"),o.show(),o.removeClass("was-validated"),e("#"+o.attr("id")+"-thank-you-message").hide()})},o.prototype.showSubmissionErrorMessage=function(){jQuery,this.form;console.log("showing submission error message..."),this.formErrorMessageWrapper.show(),this.formErrorMessageWrapper.attr("role","alert"),this.formErrorMessageWrapper.attr("aria-live","assertive")},o.prototype.showSubmissionValidationErrorMessage=function(){jQuery,this.form;console.log("showing submission validation error message..."),this.formValidationErrorMessageWrapper.show(),this.formValidationErrorMessageWrapper.attr("role","alert"),this.formValidationErrorMessageWrapper.attr("aria-live","assertive")},o.getCookie=function(e){for(var o=e+"=",r=document.cookie.split(";"),t=0;t<r.length;t++){for(var n=r[t];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(o)){var i=n.substring(o.length,n.length);try{return decodeURIComponent(i)}catch(e){return i}}}return""},o.setCookie=function(e,o,r,t){void 0===r&&(r=null),void 0===t&&(t=!1);var n=encodeURIComponent(o),i="https:"===window.location.protocol;if(t){var s="".concat(e,"=").concat(n,"; path=/; SameSite=Lax");i&&(s+="; Secure"),document.cookie=s}else{null===r&&(r=new Date).setMonth(r.getMonth()+1);s="".concat(e,"=").concat(n,"; expires=").concat(r.toUTCString(),"; path=/; SameSite=Lax");i&&(s+="; Secure"),document.cookie=s}},o.prototype.setLoadingBtn=function(e,o){if(void 0===o&&(o=!0),e.length){var r=e.find(".dws-forms-button-submit-label"),t=e.find(".spinner-border");o?(e.prop("disabled",!0),r.hide(),t.css("display","block")):(e.prop("disabled",!1),r.show(),t.hide())}},o.getFormMarkup=function(e,o,r){var t=jQuery;return console.log("getting form markup..."+e),new Promise(function(n,i){t.ajax({url:"/wp-admin/admin-ajax.php",method:"POST",data:{action:"get_dws_forms",form_id:e,vehicle_stock_number:o,theme_color:r},success:function(e){console.log("form markup received."),n(e)},error:function(e){console.log("form markup error: "+e),i(e)}})})},o.prototype.attachAccordionToggleToCheckboxes=function(){var e=jQuery;e(function(){var o=e('.dws-forms-accordion-checker input[type="checkbox"]');0!==o.length&&o.each(function(){var o=e(this),r="#"+o.attr("aria-controls");o.on("change",function(){var t=e(r);o.is(":checked")?(t.collapse("show"),o.closest("label").addClass("active")):(t.collapse("hide"),o.closest("label").removeClass("active"))})})})},o}();o.DWSFormsScript=r}(o.Plugins||(o.Plugins={}))}(e.WebSite||(e.WebSite={}))}(DealerCenter||(DealerCenter={}));