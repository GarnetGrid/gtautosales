var DealerCenter,__awaiter=this&&this.__awaiter||function(e,r,t,n){function i(e){return e instanceof t?e:new t(function(r){r(e)})}return new(t||(t=Promise))(function(t,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function l(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?t(e.value):i(e.value).then(s,l)}c((n=n.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){function t(e){return function(r){return n([e,r])}}function n(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(e,c)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,o,s,l,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l};(function(e){(function(e){(function(e){var r=function(){function e(e){this.form=e,this.init()}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(t){return e=jQuery(this.form).find(".dws-forms-section-vehicle-interested-field"),e.length>0&&this.hookSearchVehicleEvents(),r=jQuery(this.form).find(".dws-forms-section-vehicle-interested-dropdown"),r.length>0&&this.hookSearchVehicleDropdownEvents(),[2]})})},e.prototype.hookSearchVehicleEvents=function(){var e,r=this,t=jQuery,n=t(".close-vehicle-dropdown-list",this.form);t(".dws-forms-magnifying-icon",this.form).on("click touchstart",function(e){r.searchVehicle()}),t(".dws-forms-vehicle-interested-search-field",this.form).on("keypress keyup",function(t){clearTimeout(e),e=setTimeout(function(){r.searchVehicle()},800)}),n.on("click touchstart",function(){t(".dropdown-list-of-vehicles",r.form).hasClass("dropdown-displayed")&&(t(".search-string-no-results",r.form).remove(),t(".dropdown-list-of-vehicles",r.form).hide().removeClass("dropdown-displayed").next().removeClass("dropdown-displayed"))}),t(this.form).on("click touchstart",".search-results-vehicle-container",function(e){var i,o,s,l,c,a,d,h,u=t(e.currentTarget),f=u.data("item");if(f){var v=t(r.form).find("#dws-forms-vehicle-interested-field-stock-number-input"),p=t(r.form).find('[name="vehicle_interested_field_year"]'),m=t(r.form).find("#dws-forms-vehicle-interested-field-make-input"),w=t(r.form).find("#dws-forms-vehicle-interested-field-model-input"),g=t(r.form).find('[name="vehicle_interested_field_vehicle_price"]'),y=t(r.form).find("#dws-forms-vehicle-interested-field-exterior-color-input"),_=t(r.form).find("#dws-forms-vehicle-interested-field-interior-color-input"),b=t(r.form).find("#dws-forms-vehicle-interested-field-vin-input");if(v.length&&v.val(null!==(i=f.StockNumber)&&void 0!==i?i:""),p.length&&p.val(null!==(o=f.Year)&&void 0!==o?o:""),m.length&&m.val(null!==(s=f.Make)&&void 0!==s?s:""),w.length&&w.val(null!==(l=f.Model)&&void 0!==l?l:""),b.length&&b.val(null!==(c=f.Vin)&&void 0!==c?c:""),g.length)if(f.VehiclePrice){var V=f.VehiclePrice.toString().toLowerCase();V.indexOf("call")>-1||V.indexOf("-")>-1||V.indexOf("below")>-1?g.val(null):g.val(null!==(a=f.VehiclePrice)&&void 0!==a?a:null)}else g.val(null);y.length&&y.val(null!==(d=f.ExteriorColor)&&void 0!==d?d:""),_.length&&_.val(null!==(h=f.InteriorColor)&&void 0!==h?h:""),n.trigger("click")}}),t(this.form).on("click focus",".dropdown #dws-forms-price-field",function(e){var r=t(e.currentTarget),n=r.parent().find(".dropdown-menu");n.toggleClass("show")}),t(this.form).on("click focus",".dropdown.dws-forms-search-icons .dropdown-item",function(e){e.preventDefault();var n=t(e.currentTarget),i=n.parent();t("#dws-forms-price-field label",r.form).text(n.text()),i.toggleClass("show")}),t(this.form).on("click focus",".dws-forms-sort-btn",function(e){var r=t(e.currentTarget),n=r.find("svg");n.attr("style")&&n.attr("style").indexOf("rotate(180deg)")>-1?(n.removeAttr("style"),r.data("sort","desc")):(n.attr("style","transform: rotate(180deg)"),r.data("sort","asc"))})},e.prototype.hookSearchVehicleDropdownEvents=function(){return __awaiter(this,void 0,void 0,function(){var e,r,t=this;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=jQuery,[4,this.setVehicleOptionsFields()];case 1:return n.sent(),e("#dws-forms-vehicle-search-dropdown-vehicle-year",this.form).on("change",function(r){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.setVehicleOptionsFields(e(r.currentTarget).val())];case 1:return t.sent(),[2]}})})}),e("#dws-forms-vehicle-search-dropdown-vehicle-make",this.form).on("change",function(r){return __awaiter(t,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:return t=e("#dws-forms-vehicle-search-dropdown-vehicle-year",this.form).val(),n=e(r.currentTarget).val(),[4,this.setVehicleOptionsFields(t,n)];case 1:return i.sent(),[2]}})})}),e("#dws-forms-vehicle-search-dropdown-vehicle-model",this.form).on("change",function(r){return __awaiter(t,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:return t=e("#dws-forms-vehicle-search-dropdown-vehicle-year",this.form).val(),n=e("#dws-forms-vehicle-search-dropdown-vehicle-make",this.form).val(),i=e(r.currentTarget).val(),[4,this.setVehicleOptionsFields(t,n,i)];case 1:return o.sent(),[2]}})})}),[3,3];case 2:return r=n.sent(),console.error(r),[3,3];case 3:return[2]}})})},e.prototype.setVehicleOptionsFields=function(e,r,t){return void 0===e&&(e=""),void 0===r&&(r=""),void 0===t&&(t=""),__awaiter(this,void 0,void 0,function(){var n,i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,11,,12]),n=jQuery,[4,this.getVehiclesOption(e,r,t)];case 1:return i=s.sent(),i?(i=JSON.parse(i),e?[3,3]:[4,this.setOptionsByElement(n("#dws-forms-vehicle-search-dropdown-vehicle-year",this.form),i.year)]):[2];case 2:s.sent(),s.label=3;case 3:return r?[3,5]:[4,this.setOptionsByElement(n("#dws-forms-vehicle-search-dropdown-vehicle-make",this.form),i.make)];case 4:s.sent(),s.label=5;case 5:return t?[3,7]:[4,this.setOptionsByElement(n("#dws-forms-vehicle-search-dropdown-vehicle-model",this.form),i.model)];case 6:s.sent(),s.label=7;case 7:return[4,this.setOptionsByElement(n("#dws-forms-vehicle-search-dropdown-mileage",this.form),i.mileage)];case 8:return s.sent(),[4,this.setOptionsByElement(n("#dws-forms-vehicle-search-dropdown-price",this.form),i.price_range)];case 9:return s.sent(),[4,this.setStockNumber()];case 10:return s.sent(),[3,12];case 11:return o=s.sent(),console.error(o),[3,12];case 12:return[2]}})})},e.prototype.setStockNumber=function(){return __awaiter(this,void 0,void 0,function(){var e,r,t,n,i,o,s,l;return __generator(this,function(c){switch(c.label){case 0:return e=jQuery,r=e("#dws-forms-vehicle-search-dropdown-vehicle-year",this.form).val(),t=e("#dws-forms-vehicle-search-dropdown-vehicle-make",this.form).val(),n=e("#dws-forms-vehicle-search-dropdown-vehicle-model",this.form).val(),i=e("#dws-forms-vehicle-search-dropdown-mileage",this.form).val(),o=e("#dws-forms-vehicle-search-dropdown-price",this.form).val(),r&&t&&n?[4,this.getVehicleByYearMakeModel(r,t,n,i,o)]:[3,2];case 1:s=c.sent(),l=e("#dws-forms-vehicle-search-dropdown-vehicle-stock-number",this.form),s&&l.length&&l.val(s),c.label=2;case 2:return[2]}})})},e.prototype.getVehicleByYearMakeModel=function(e,r,t,n,i){return void 0===n&&(n=""),void 0===i&&(i=""),new Promise(function(o){jQuery.ajax({url:"/wp-admin/admin-ajax.php",method:"POST",data:{action:"get_search_vehicles",keyword:e+" "+r+" "+t},success:function(e){var r=JSON.parse(e);if(r&&r.Vehicles.length){var t=r.Vehicles;r.Vehicles.length>1&&(n&&(r.Vehicles=r.Vehicles.filter(function(e){return e.VehiclePrice>=n.split("-")[0]&&e.VehiclePrice<=n.split("-")[1]})),i&&(r.Vehicles=r.Vehicles.filter(function(e){return e.Odometer>=i.split("-")[0]&&e.Odometer<=i.split("-")[1]}))),0!=r.Vehicles.length?o(r.Vehicles[0].StockNumber):o(t[0].StockNumber)}else o("")},error:function(){o("")}})})},e.prototype.getVehiclesOption=function(e,r,t){return void 0===e&&(e=""),void 0===r&&(r=""),void 0===t&&(t=""),new Promise(function(n,i){jQuery.ajax({url:"/wp-admin/admin-ajax.php",method:"POST",data:{action:"get_interested_vehicles_options",year:e,make:r,model:t},success:function(e){n(e)},error:function(e){i(e)}})})},e.prototype.setOptionsByElement=function(e,r){return new Promise(function(t){if(e&&r){e.find("option[value!='']").remove();var n="";r.forEach(function(e){if(-1!=(""+e).indexOf("-")){var t=e.split("-");n+='<option value="'+e+'" '+(1==r.length?"selected":"")+">"+t[0]+" - "+t[1]+"</option>"}else n+='<option value="'+e+'" '+(1==r.length?"selected":"")+">"+e+"</option>"}),e.append(n),t(!0)}else t(!1)})},e.prototype.searchVehicle=function(){var e,r=this,t=jQuery,n=t(".dws-forms-vehicle-interested-search-field",this.form),i=n.val();clearTimeout(e),e=setTimeout(function(){return __awaiter(r,void 0,void 0,function(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.getVehicles(i)];case 1:return e=o.sent(),e?(e=JSON.parse(e),r=t(".dropdown-list-of-vehicles",this.form),e&&e.TotalRecordCount&&0!=e.Vehicles.length?(r.empty(),e.Vehicles.forEach(function(e){var n,i,o="";if(e.VehicleImageCount>0){var s=null!==(i=null===(n=e.VehicleImages.find(function(e){return e.IsDefault}))||void 0===n?void 0:n.DocumentId)&&void 0!==i?i:e.VehicleImages[0].DocumentId;o=s?DWS_CONST_INV_IMAGE_URL.replace("{DocumentId}",s).replace("{width}","200").replace("{height}","200"):""}else o="/dealercenter/img/vehicle-image-notavailable-320x240.jpg";var l=t('\n                        <li>\n                            <div class="search-results-vehicle-container" data-item=\''+JSON.stringify(e)+'\'>\n                                <div class="search-results-vehicle-image">\n                                    <img src="'+o+'" class="dropdown-vehicle-image">\n                                </div>\n                                \n                                <div class="search-results-vehicle-details">\n                                    <div class="search-results-vehicle-title">'+e.YMMT+'</div>\n\n                                    <div class="search-results-vehicle-options row">\n                                        <div class="col-sm-6">\n                                            '+(e.Vin?'<div class="vehicle-column">\n                                                    <label>VIN:</label>\n                                                    <span>'+e.Vin+"</span>\n                                                </div>":"")+"\n                                            \n                                            "+(e.VehiclePrice?'<div class="vehicle-column">\n                                                    <label>Price:</label>\n                                                    <span>'+e.VehiclePrice+"</span>\n                                                </div>":"")+'\n                                        </div>\n\n                                        <div class="col-sm-6">\n                                            <div class="vehicle-column">\n                                                <label>Stock #:</label>\n                                                <span>'+e.StockNumber+'</span>\n                                            </div>\n\n                                            <div class="vehicle-column">\n                                                <label>Miles:</label>\n                                                <span>'+e.Odometer+"</span>\n                                            </div>\n                                        </div>\n\n                                        "+(e.InteriorColor?'<div ng-if="vehicles.InteriorColor" class="ng-scope">\n                                                <div class="vehicle-column col-xs-12">\n                                                    <label>Int Color:</label>\n                                                    <span>'+e.InteriorColor+"</span>\n                                                </div>\n                                            </div>":"")+"\n                                        \n                                        "+(e.ExteriorColor?'<div ng-if="vehicles.ExteriorColor" class="ng-scope">\n                                                <div class="vehicle-column col-xs-12">\n                                                    <label>Ext Color:</label>\n                                                    <span>'+e.ExteriorColor+"</span>\n                                                </div>\n                                            </div>":"")+"\n                                    </div>\n                                </div>\n                            </div>\n                        </li>");r.append(l)}),r.show().addClass("dropdown-displayed").next().addClass("dropdown-displayed"),r.hasClass("dropdown-displayed")&&r.on("touchstart",function(e){e.stopPropagation()}),[3,3]):(r.empty(),r.append('<li class="search-string-no-results">No results found</li>'),r.show().addClass("dropdown-displayed").next().addClass("dropdown-displayed"),[2])):[2];case 2:return n=o.sent(),console.error(n),[3,3];case 3:return[2]}})})},500)},e.prototype.getVehicles=function(e){return __awaiter(this,void 0,void 0,function(){var r,t,n;return __generator(this,function(i){return r=jQuery,e?(t=r("#dws-forms-price-field label",this.form).first().text(),n=r(".dws-forms-sort-btn",this.form).data("sort"),[2,new Promise(function(i,o){r.ajax({url:"/wp-admin/admin-ajax.php",method:"POST",data:{action:"get_search_vehicles",keyword:e,sortBy:t,sortDirection:n},success:function(e){i(e)},error:function(e){o(e)}})})]):[2]})})},e}();e.DWSFormsVehicleInterestedSearch=r})(e.Plugins||(e.Plugins={}))})(e.WebSite||(e.WebSite={}))})(DealerCenter||(DealerCenter={}));